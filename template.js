!function(t){"use strict";function e(){this.unique_id=u++,this._container=document.body,this._maxWidth="70%",this._point=null,this._html=null,this._directions=x,this._fallbackFit="horizontal",this.handlers={click:[]}}function r(t){return t.replace(/[&<>]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;"}[t]})}function n(t,e,r){var n,i=document.createElementNS("http://www.w3.org/2000/svg",t);if(e)for(n in e)i.setAttribute(n,e[n]);var a=i.style;if(r)for(n in r)a[n]=r[n];return i}function i(t,e,r,n,i,a,o){var s,l=r-t/2-_,h=r+t/2+_,p=t/2+Math.min(0,l-i.left)+Math.max(0,h-i.right);return s=p-g<m?[-p,(-_-m)*a,Math.max(g,m-p),-_*a]:p+g>t-m?[Math.min(-g,t-p-m),-_*a,Math.min(g,t-p),(-_-m)*a]:[-g,-_*a,g,-_*a],{pos:[p,o],shape:s}}function a(t,e,r,n,i,a,o){var s,l=n-e/2-_,h=n+e/2+_,p=e/2+Math.min(0,l-i.top)+Math.max(0,h-i.bottom);return s=p-g<m?[(-_-m)*a,-p,-_*a,Math.max(g,m-p)]:p+g>e-m?[-_*a,Math.min(-g,e-p-m),(-_-m)*a,Math.min(g,e-p)]:[-_*a,-g,-_*a,g],{pos:[o,p],shape:s}}function o(t,e,r,n,i,a){var o=v[t](e,r,n,i,a),s=n-f-o.pos[0],l=i-f-o.pos[1];return{left:s,top:l,right:s+e+2*f,bottom:l+r+2*f}}function s(t,e,r,n,i,a,o,s,l,h){var p=v[t](n,i,s,l,h);e.left=a-f-p.pos[0]+"px",e.top=o-f-p.pos[1]+"px",r.setAttribute("d","M0,0L"+p.shape.join(",")+"Z"),r.setAttribute("transform","translate("+(p.pos[0]+f)+","+(p.pos[1]+f)+")")}function l(){function t(t,e){return F[e%F.length]}y.attr("width",window.innerWidth).attr("height",window.innerHeight),w.attr("transform","translate("+S.margin_left+","+S.margin_top+")"),M=window.innerWidth-S.margin_left-S.margin_right,k=window.innerHeight-S.margin_top-S.margin_bottom,E("#clip rect").attr("height",k+S.shade_width).attr("transform","translate(0,-"+S.shade_width/2+")"),C=d3.scaleLinear().range([0,M]).domain(d3.extent(z.horserace,function(t,e){return e})),A=d3.scaleLinear().range([k,0]).domain([d3.max(z.horserace,function(t){return d3.max(t.horses,function(t){return+t})}),d3.min(z.horserace,function(t){return d3.min(t.horses,function(t){return+t})})]),F=d3[S.palette];var e=d3.axisTop(C).tickFormat(function(t){return z.horserace[t].timeslice});E(".x.axis").call(e).selectAll("text").style("text-anchor","start").attr("dx","2.3em").attr("dy","-0.9em").attr("transform","rotate(-45)");var r=d3.axisLeft(A).tickSize(-M).tickPadding(10);E(".y.axis").call(r);for(var n=[],i=0;i<z.horserace.column_names.horses.length;i++){for(var a=z.horserace.column_names.horses[i],o=[],s=0;s<z.horserace.length;s++){var l=z.horserace[s].horses;o.push(l[i])}n.push({name:a,ranks:o})}var c=w.selectAll(".horse").data(n),u=c.enter().append("g").attr("class","horse").on("mouseover",h).on("mouseout",p);u.append("path").attr("class","shade").attr("clip-path","url(#clip)").attr("fill","none"),u.append("path").attr("class","line").attr("clip-path","url(#clip)").attr("fill","none");var f=c.merge(u);f.select(".line").attr("d",function(t){return W(t.ranks)}).attr("stroke",t).attr("opacity",S.line_opacity).attr("stroke-width",S.line_width),f.select(".shade").attr("d",function(t){return W(t.ranks)}).attr("stroke",t).attr("display",S.shade?"block":"none").attr("opacity",S.shade_opacity).attr("stroke-width",S.shade_width),c.exit().remove();var m=w.selectAll(".start.circle").data(n),g=m.enter().append("circle").attr("class","horse start circle").attr("cx","0").attr("cy",function(t){return A(t.ranks[0])}).attr("r",5).attr("fill",t);m.merge(g).select(".start.circle").attr("r",S.start_circle_r),m.exit().remove();var _=w.selectAll(".end-group").data(n),x=_.enter().append("g").attr("class","horse").attr("fill",t).on("mouseover",h).on("mouseout",p),b=x.append("g").attr("class","end-group").attr("transform",function(t){return"translate("+C(S.timeslice)+","+A(t.ranks[S.timeslice])+")"});b.append("circle").attr("class","end circle").attr("fill",t),b.append("text").attr("class","rank-number").attr("alignment-baseline","central").attr("fill","white").attr("text-anchor","middle"),b.append("text").attr("class","name").attr("alignment-baseline","central").attr("x",S.end_circle_r+2).text(function(t){return t.name});var v=_.merge(x);v.select(".end.circle").attr("r",S.end_circle_r),v.select(".rank-number").attr("font-size",S.rank_font_size),v.select(".name").attr("font-size",S.label_font_size),_.exit().remove(),d()}function h(t,e){L(".horse").attr("opacity",function(t){return z.horserace.column_names.horses[e]==t.name?1:.05})}function p(t,e){L(".horse").attr("opacity",1)}function c(){var t=E("body");y=t.append("svg"),w=y.append("g").attr("id","plot"),w.append("clipPath").attr("id","clip").append("rect").attr("width",0),w.append("g").attr("class","x axis"),w.append("g").attr("class","y axis"),t.append("div").attr("id","replay").style("position","absolute").style("left","10px").style("top","10px").text("Replay").on("click",d),l(),window.onresize=l}function d(){for(var t=0;t<z.horserace.length;t++)E("#clip rect").transition().ease(d3.easeLinear).duration(S.duration).delay(t*S.duration).attr("width",C(t)),L(".end-group").transition().ease(d3.easeLinear).duration(S.duration).delay(t*S.duration).attr("transform",function(e){return"translate("+C(t)+","+A(e.ranks[t])+")"}).select(".rank-number").text(function(e){return e.ranks[t]})}var u=0,f=25,m=5,g=10,_=10,x=["bottom","top","left","right","topLeft","bottomLeft","topRight","bottomRight","bottomFlexible","topFlexible","leftFlexible","rightFlexible"];for(var b in new e("*"))!function(t,e){e.length>0&&"_"==e.charAt(0)&&(t[e.substr(1)]=function(t){return void 0===t?this[e]:(this[e]=t,this)})}(e.prototype,b);e.prototype.point=function(t,e){if(void 0===t)return this._point;if(void 0!==e)this._point=[t,e];else if(t instanceof HTMLElement||t instanceof SVGElement){var r=t.getBoundingClientRect();this._point=[Math.floor(r.left+r.width/2),Math.floor(r.top+r.height/2)]}else console.error("Popup: could not understand argument");return this},e.prototype.text=function(t){return this._html=r(t),this},e.prototype.on=function(t,e){if(!(t in this.handlers))throw new Error("Popup.on: No such event: "+t);return this.handlers[t].push(e),this},e.prototype.fire=function(t,e){if(!(t in this.handlers))throw new Error("Popup.fire: No such event: "+t);for(var r=this.handlers[t],n=0;n<r.length;n++)r[n].call(this,e);return this},e.prototype._getElement=function(){var t=this,e="flourish-popup-"+this.unique_id,r=document.getElementById(e);if(!r){r=document.createElement("div"),r.className="flourish-popup",r.id=e;var i=r.style;i.display="none",i.margin=i.padding=0,i.position="absolute",i.width="80px",i.height="40px",i.boxSizing="border-box",r.addEventListener("click",function(e){t.fire("click",e)},!1);var a=n("svg",{class:"flourish-popup-svg"},{position:"absolute",top:0,left:0,bottom:0,right:0}),o=n("filter",{id:"dropshadow-"+this.unique_id,height:"130%"});o.appendChild(n("feGaussianBlur",{in:"SourceAlpha",stdDeviation:5})),o.appendChild(n("feOffset",{dx:0,dy:2,result:"offsetblur"}));var s=n("feComponentTransfer");s.appendChild(n("feFuncA",{type:"linear",slope:.2})),o.appendChild(s);var l=n("feMerge");o.appendChild(l),l.appendChild(n("feMergeNode")),l.appendChild(n("feMergeNode",{in:"SourceGraphic"})),a.appendChild(o);var h=n("g",{filter:"url(#dropshadow-"+this.unique_id+")",fill:"white",stroke:"none"});h.appendChild(n("rect",{x:f,y:f,rx:m})),h.appendChild(n("path")),a.appendChild(h),r.appendChild(a);var p=document.createElement("div");p.className="flourish-popup-content",i=p.style,i.position="absolute",i.top=i.left=f+"px",i.padding="10px",r.appendChild(p),document.body.appendChild(r)}return r};var v={};v.bottom=function(t,e){return{shape:[-g,-_,g,-_],pos:[t/2,e+_]}},v.top=function(t,e){return{shape:[-g,_,g,_],pos:[t/2,-_]}},v.left=function(t,e){return{shape:[_,g,_,-g],pos:[-_,e/2]}},v.right=function(t,e){return{shape:[-_,g,-_,-g],pos:[t+_,e/2]}},v.topLeft=function(t,e){return{shape:[_+m,_,_,_+m],pos:[-_,-_]}},v.bottomLeft=function(t,e){return{shape:[_+m,-_,_,-_-m],pos:[-_,e+_]}},v.topRight=function(t,e){return{shape:[-_-m,_,-_,_+m],pos:[t+_,-_]}},v.bottomRight=function(t,e){return{shape:[-_-m,-_,-_,-_-m],pos:[t+_,e+_]}},v.bottomFlexible=function(t,e,r,n,a){return i(t,e,r,n,a,1,e+_)},v.topFlexible=function(t,e,r,n,a){return i(t,e,r,n,a,-1,-_)},v.rightFlexible=function(t,e,r,n,i){return a(t,e,r,n,i,1,t+_)},v.leftFlexible=function(t,e,r,n,i){return a(t,e,r,n,i,-1,-_)},e.prototype.__maxContentWidth=function(t){return this._maxWidth.match(/^\d+(?:\.\d+)?%$/)?t.width*parseFloat(this._maxWidth)/100:this._maxWidth.match(/^\d+(?:\.\d+)?(?:px)?$/)?parseFloat(this._maxWidth):(null!=this._maxWidth&&console.error("Popup: Unknown value for maxWidth: "+this._maxWidth),t.width)},e.prototype.draw=function(){if(!this._point)return void console.error("Popup: cannot draw popup till point() has been specified");var t=document.documentElement.getBoundingClientRect(),e=this._point[0],r=this._point[1],n=this._container.getBoundingClientRect();e<n.left?e=n.left:e>n.right&&(e=n.right),r<n.top?r=n.top:r>n.bottom&&(r=n.bottom);var i=e-t.left,a=r-t.top,l=this._getElement(),h=l.style,p=l.querySelector(".flourish-popup-svg"),c=p.querySelector("g"),d=c.querySelector("rect"),u=c.querySelector("path"),m=l.querySelector(".flourish-popup-content");h.display="block",m.style.maxWidth=this.__maxContentWidth(n)+"px",m.innerHTML=this._html;var g,x,b=m.getBoundingClientRect();do{g=Math.ceil(b.width),x=Math.ceil(b.height),h.width=g+2*f+"px",h.height=x+2*f+"px",b=m.getBoundingClientRect()}while(g!=Math.ceil(b.width)||x!=Math.ceil(b.height));d.setAttribute("width",g),d.setAttribute("height",x),p.setAttribute("width",g+2*f),p.setAttribute("height",x+2*f);for(var v,y,w=f-_,k=null,M=null,C=null,A=1/0,F=1/0,E=0;E<this._directions.length;E++){var L=this._directions[E],W=o(L,g,x,e,r,n),z=Math.max(0,Math.floor(n.left)-W.left-w)+Math.max(0,W.right-Math.ceil(n.right)-w),S=Math.max(0,Math.floor(n.top)-W.top-w)+Math.max(0,W.bottom-Math.ceil(n.bottom)-w);if(0==z&&0==S){k=L;break}(z<A||z==A&&S<v)&&(A=z,v=S,M=L),(S<F||S==F&&z<y)&&(F=S,y=z,C=L)}return k?L=k:"horizontal"==this._fallbackFit?L=M:"vertical"==this._fallbackFit?L=C:(console.warn("Popup: failed to point box of size ("+g+", "+x+") at ("+e+", "+r+") within ("+n.left+", "+n.top+", "+n.right+", "+n.bottom+")"),L=this._directions[0]),s(L,h,u,g,x,i,a,e,r,n),this},e.prototype.hide=function(){return this._getElement().style.display="none",this};var y,w,k,M,C,A,F,E=d3.select,L=d3.selectAll,W=d3.line().x(function(t,e){return C(e)}).y(function(t){return A(t)}),z={},S={margin_top:100,margin_right:120,margin_bottom:50,margin_left:50,start_circle_r:2,end_circle_r:10,label_font_size:12,rank_font_size:14,palette:"schemeCategory20",shade:!0,shade_opacity:.1,shade_width:20,line_opacity:1,line_width:2,duration:300,timeslice:0};t.data=z,t.state=S,t.update=l,t.draw=c}(this.template=this.template||{});
//# sourceMappingURL=template.js.map
