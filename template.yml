id: flourish/horserace
name: Horserace chart
author: Flourish & Google News Lab teams
description: A “horserace” or “bump” chart to show changing rank over time
image_download: false
autoheight:
  600: 450px
  1000: 4x3
  ∞: 750px
sdk_version: 2

build:
  src:
    script: npm run build
    directory: src
    files:
      - rollup.config.js
  less:
    script: npm run less
    directory: less

settings:
  - Scoring type
  - property: value_type
    name: Mode to show on load
    type: string
    style: button-group
    width: half
    choices:
      -
        - Ranks
        - ranks
      -
        - Scores
        - scores
  - property: show_buttons
    name: Allow users to switch between modes
    type: boolean
  - property: higher_scores_win
    name: Higher scores win
    description: Uncheck this if lower scores beat higher scores (e.g. race times)
    type: boolean

  - Line styles
  - property: line_width
    name: Line width
    description: Width in pixels
    type: number
  - property: line_opacity
    name: Line opacity
    description: Set to a value between 0 and 1
    type: number
    min: 0
    max: 1
    step: 0.05
  - property: curve
    name: Curve
    type: string
    choices:
      -
        - Straight
        - curveLinear
      -
        - Normal curve
        - curveMonotoneX
      -
        - Overflowing curve
        - curveNatural
      -
        - Step middle
        - curveStep
      -
        - Step after
        - curveStepAfter
      -
        - Step before
        - curveStepBefore
  - property: shade
    new_section: true
    name: Show shading behind line
    type: boolean
  - property: shade_width
    name: Shading width
    description: Width in pixels
    show_if: shade
    type: number
  - property: shade_opacity
    name: Shading opacity
    description: Set to a value between 0 and 1
    min: 0
    max: 1
    step: 0.05
    show_if: shade
    type: number
  - Circles and labels
  - property: start_circle_r
    name: Start radius
    type: number
    min: 0
  - property: end_circle_r
    name: End radius
    type: number
    min: 0
  - property: rank_font_size
    name: Rank font size
    type: number
  - property: label_font_size
    name: Label font size
    type: number
  - property: label_decimals
    name: Number of decimal places on scores
    type: number
  - property: rank_label_suffix
    name: Suffix
    type: string
    width: half
  - property: horse_images
    name: Use image
    type: boolean
  - property: rank_outside_picture
    name: Put score next to circle
    type: boolean

  - Colours
  - property: bg_color
    name: Background colour
    type: color
  - property: palette
    name: Colour scheme
    description: Select a color scheme, or fill in a comma separated list of color values (eg. '#855C75,#D9AF6B,#AF6458')
    type: string
    width: half
    choices_other: true
    choices:
      -
        - Flourish default 1
        - flourish_default_1
      -
        - Flourish default 2
        - flourish_default_2
      -
        - Rainbow
        - carto_rainbow
      -
        - Pastel light
        - carto_pastel
      -
        - Pastel dark
        - carto_antique
      -
        - Category 10
        - schemeCategory10
      -
        - Category 20
        - schemeCategory20
      -
        - Category 20b
        - schemeCategory20b
      -
        - Category 20c
        - schemeCategory20c
      -
        - Accent
        - schemeAccent
      -
        - Dark 2
        - schemeDark2
      -
        - Paired
        - schemePaired
      -
        - Pastel 1
        - schemePastel1
      -
        - Pastel 2
        - schemePastel2
  - Animation
  - property: stage_duration
    name: Animation duration
    description: The “race” animation length, in milliseconds per stage
    type: number
    min: 0
    step: 100
  - property: update_duration
    name: Mode duration
    description: The animation duration when change between ranks and scores modes
    type: number
    min: 0
    step: 100

  - Margins
  - property: margin_top
    name: Top
    type: number
    min: 0
    step: 10
    width: quarter
  - property: margin_right
    name: Right
    type: number
    min: 0
    step: 10
    width: quarter
  - property: margin_bottom
    name: Bottom
    type: number
    min: 0
    step: 10
    width: quarter
  - property: margin_left
    name: Left
    type: number
    min: 0
    step: 10
    width: quarter

  - Y axis
  - property: y_axis_min
    name: Min score
    type: number
    optional: true
  - property: y_axis_max
    name: Max score
    type: number
    optional: true
  - property: y_axis_tick_prefix
    name: Number prefix
    type: string
    width: half
  - property: y_axis_tick_suffix
    name: Number suffix
    type: string
    width: half
  - property: y_axis_min_rank
    name: Min rank
    type: number
    optional: true
    new_section: true
  - property: y_axis_max_rank
    name: Max rank
    type: number
    optional: true

data:
  - Data
  - name: Name column
    description: The name of each entrant
    dataset: horserace
    key: name
    type: column
    column: "Data::A"
    datatype: string
  - name: Image column
    description: The URL of the image to use
    dataset: horserace
    key: pic
    type: column
    column: "Data::B"
    optional: true
    datatype: url
  - name: Score columns
    description: >-
      Raw scores, which will be automatically
      converted to ranks. Column names will
      be used to populate the x-axis of the chart.
    dataset: horserace
    key: stages
    type: columns
    columns: "Data::C-L"
    datatype: number
