{"version":3,"file":null,"sources":["node_modules/@flourish/popup/src/popup.js","src/index.js"],"sourcesContent":["var VERSION = \"1.1.1\";\n\nvar next_unique_id = 0;\n\nvar BORDER = 25,\n    CORNER_RADIUS = 5,\n    TRIANGLE_HALFWIDTH = 10,\n    TRIANGLE_HEIGHT = 10,\n\n    // The order of the list of directions determines the\n    // default priority ordering.\n    ALL_DIRECTIONS = [\n    \t\"bottom\", \"top\", \"left\", \"right\",\n    \t\"topLeft\", \"bottomLeft\", \"topRight\", \"bottomRight\",\n    \t\"bottomFlexible\", \"topFlexible\", \"leftFlexible\", \"rightFlexible\"\n    ];\n\nfunction Popup() {\n\tthis.unique_id = next_unique_id++;\n\n\tthis._container = document.body;\n\tthis._maxWidth = \"70%\";\n\tthis._point = null;\n\tthis._html = null;\n\tthis._directions = ALL_DIRECTIONS;\n\tthis._fallbackFit = \"horizontal\"; // or \"vertical\"\n\n\tthis.handlers = {\n\t\t\"click\": []\n\t};\n}\n\n// Create accessor methods for all the _parameters defined by the constructor\nfunction accessor(proto, k) {\n\tif (k.length > 0 && k.charAt(0) == \"_\") {\n\t\tproto[k.substr(1)] = function(v) {\n\t\t\tif (typeof v == \"undefined\") return this[k];\n\t\t\tthis[k] = v;\n\t\t\treturn this;\n\t\t};\n\t}\n}\nfor (var k in new Popup(\"*\")) {\n\taccessor(Popup.prototype, k);\n}\n\n// Custom accessor method for .point\nPopup.prototype.point = function(arg1, arg2) {\n\tif (typeof arg1 == \"undefined\") return this._point;\n\n\tif (typeof arg2 != \"undefined\") this._point = [ arg1, arg2 ];\n\telse if (arg1 instanceof HTMLElement || arg1 instanceof SVGElement) {\n\t\tvar r = arg1.getBoundingClientRect();\n\t\tthis._point = [ Math.floor(r.left + r.width/2), Math.floor(r.top + r.height/2) ];\n\t}\n\telse {\n\t\tconsole.error(\"Popup: could not understand argument\")\n\t}\n\n\treturn this;\n}\n\nfunction textToHtml(text) {\n\treturn text.replace(/[&<>]/g, function (s) {\n\t\treturn ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\" })[s];\n\t});\n}\n\n// Accessor (setter only) for setting plain text\nPopup.prototype.text = function Popup_text(t) {\n\tthis._html = textToHtml(t);\n\treturn this;\n};\n\n// Attach event handlers\nPopup.prototype.on = function Popup_on(event, handler) {\n\tif (!(event in this.handlers)) throw new Error(\"Popup.on: No such event: \" + event);\n\tthis.handlers[event].push(handler);\n\treturn this;\n};\n\n// Fire event\nPopup.prototype.fire = function Popup_fire(event, d) {\n\tif (!(event in this.handlers)) throw new Error(\"Popup.fire: No such event: \" + event);\n\tvar handlers = this.handlers[event];\n\tfor (var i = 0; i < handlers.length; i++) {\n\t\thandlers[i].call(this, d);\n\t}\n\treturn this;\n};\n\n\n// Draw the popup\nfunction svgElement(tagName, attrs, styles) {\n\tvar element = document.createElementNS(\"http://www.w3.org/2000/svg\", tagName);\n\tvar k;\n\tif (attrs) for (k in attrs) element.setAttribute(k, attrs[k]);\n\n\tvar s = element.style;\n\tif (styles) for (k in styles) s[k] = styles[k];\n\n\treturn element;\n}\n\nPopup.prototype._getElement = function Popup__getElement() {\n\tvar popup = this;\n\tvar id = \"flourish-popup-\" + this.unique_id;\n\tvar el = document.getElementById(id);\n\tif (!el) {\n\t\tel = document.createElement(\"div\");\n\t\tel.className = \"flourish-popup\";\n\t\tel.id = id;\n\n\t\tvar s = el.style;\n\t\ts.display = \"none\";\n\t\ts.margin = s.padding = 0;\n\t\ts.position = \"absolute\";\n\t\ts.width = \"80px\";\n\t\ts.height = \"40px\";\n\t\ts.boxSizing = \"border-box\";\n\n\t\tel.addEventListener(\"click\", function(e) {\n\t\t\tpopup.fire(\"click\", e);\n\t\t}, false);\n\n\t\tvar svg = svgElement(\"svg\", {\"class\": \"flourish-popup-svg\"}, {\n\t\t\tposition: \"absolute\",\n\t\t\ttop: 0, left: 0, bottom: 0, right: 0\n\t\t});\n\n\t\tvar filter = svgElement(\"filter\", {id: \"dropshadow-\" + this.unique_id, height: \"130%\"});\n\t\tfilter.appendChild(svgElement(\"feGaussianBlur\", {\"in\": \"SourceAlpha\", stdDeviation: 5}));\n\t\tfilter.appendChild(svgElement(\"feOffset\", {dx: 0, dy: 2, result: \"offsetblur\"}));\n\t\tvar fe_component_transfer = svgElement(\"feComponentTransfer\");\n\t\tfe_component_transfer.appendChild(svgElement(\"feFuncA\", {type: \"linear\", slope: 0.2}));\n\t\tfilter.appendChild(fe_component_transfer);\n\t\tvar fe_merge = svgElement(\"feMerge\");\n\t\tfilter.appendChild(fe_merge);\n\t\tfe_merge.appendChild(svgElement(\"feMergeNode\"));\n\t\tfe_merge.appendChild(svgElement(\"feMergeNode\", {\"in\": \"SourceGraphic\"}));\n\t\tsvg.appendChild(filter);\n\n\t\tvar g = svgElement(\"g\", {\n\t\t\tfilter: \"url(#dropshadow-\" + this.unique_id + \")\",\n\t\t\tfill: \"white\",\n\t\t\tstroke: \"none\"\n\t\t});\n\t\tg.appendChild(svgElement(\"rect\", {x: BORDER, y: BORDER, rx: CORNER_RADIUS}));\n\t\tg.appendChild(svgElement(\"path\"));\n\t\tsvg.appendChild(g);\n\t\tel.appendChild(svg);\n\n\t\tvar content = document.createElement(\"div\");\n\t\tcontent.className = \"flourish-popup-content\";\n\t\ts = content.style;\n\t\ts.position = \"absolute\";\n\t\ts.top = s.left = BORDER + \"px\";\n\t\ts.padding = \"10px\";\n\t\tel.appendChild(content);\n\n\t\tdocument.body.appendChild(el);\n\t}\n\n\treturn el;\n}\n\nvar locateTriangle = {};\n\nlocateTriangle.bottom = function locateTriangle_bottom(w, h) {\n\treturn {\n\t\tshape: [ -TRIANGLE_HALFWIDTH, -TRIANGLE_HEIGHT,  TRIANGLE_HALFWIDTH, -TRIANGLE_HEIGHT ],\n\t\tpos: [w/2, h + TRIANGLE_HEIGHT]\n\t};\n};\n\nlocateTriangle.top = function locateTriangle_top(w, h) {\n\treturn {\n\t\tshape: [ -TRIANGLE_HALFWIDTH, TRIANGLE_HEIGHT,  TRIANGLE_HALFWIDTH, TRIANGLE_HEIGHT ],\n\t\tpos: [w/2, -TRIANGLE_HEIGHT]\n\t};\n};\n\nlocateTriangle.left = function locateTriangle_left(w, h) {\n\treturn {\n\t\tshape: [ TRIANGLE_HEIGHT, TRIANGLE_HALFWIDTH,  TRIANGLE_HEIGHT, -TRIANGLE_HALFWIDTH ],\n\t\tpos: [-TRIANGLE_HEIGHT, h/2]\n\t};\n};\n\nlocateTriangle.right = function locateTriangle_right(w, h) {\n\treturn {\n\t\tshape: [ -TRIANGLE_HEIGHT, TRIANGLE_HALFWIDTH, -TRIANGLE_HEIGHT, -TRIANGLE_HALFWIDTH ],\n\t\tpos: [w + TRIANGLE_HEIGHT, h/2]\n\t};\n};\n\nlocateTriangle.topLeft = function locateTriangle_topLeft(w, h) {\n\treturn {\n\t\tshape: [ TRIANGLE_HEIGHT + CORNER_RADIUS, TRIANGLE_HEIGHT,\n\t\t         TRIANGLE_HEIGHT, TRIANGLE_HEIGHT + CORNER_RADIUS ],\n\t\tpos: [-TRIANGLE_HEIGHT, -TRIANGLE_HEIGHT]\n\t};\n};\n\nlocateTriangle.bottomLeft = function locateTriangle_bottomLeft(w, h) {\n\treturn {\n\t\tshape: [ TRIANGLE_HEIGHT + CORNER_RADIUS, -TRIANGLE_HEIGHT,\n\t\t\t       TRIANGLE_HEIGHT, -TRIANGLE_HEIGHT - CORNER_RADIUS ],\n\t\tpos: [-TRIANGLE_HEIGHT, h + TRIANGLE_HEIGHT]\n\t};\n};\n\nlocateTriangle.topRight = function locateTriangle_topRight(w, h) {\n\treturn {\n\t\tshape: [ -TRIANGLE_HEIGHT - CORNER_RADIUS, TRIANGLE_HEIGHT,\n\t\t\t       -TRIANGLE_HEIGHT, TRIANGLE_HEIGHT + CORNER_RADIUS ],\n\t\tpos: [w + TRIANGLE_HEIGHT, -TRIANGLE_HEIGHT]\n\t};\n};\n\nlocateTriangle.bottomRight = function locateTriangle_bottomRight(w, h) {\n\treturn {\n\t\tshape: [ -TRIANGLE_HEIGHT - CORNER_RADIUS, -TRIANGLE_HEIGHT,\n\t\t\t       -TRIANGLE_HEIGHT, -TRIANGLE_HEIGHT - CORNER_RADIUS ],\n\t\tpos: [w + TRIANGLE_HEIGHT, h + TRIANGLE_HEIGHT]\n\t};\n};\n\nfunction hFlexTriangle(w, h, x, y, cb, y_factor, y_pos) {\n\tvar l = x - w/2 - TRIANGLE_HEIGHT, r = x + w/2 + TRIANGLE_HEIGHT,\n\t    px = w/2 + Math.min(0, l - cb.left) + Math.max(0, r - cb.right),\n\t    shape;\n\n\tif (px - TRIANGLE_HALFWIDTH < CORNER_RADIUS) {\n\t\tshape = [ -px , (-TRIANGLE_HEIGHT - CORNER_RADIUS) * y_factor,\n\t\t\t\tMath.max(TRIANGLE_HALFWIDTH, CORNER_RADIUS - px), -TRIANGLE_HEIGHT * y_factor ];\n\t}\n\telse if (px + TRIANGLE_HALFWIDTH > w - CORNER_RADIUS) {\n\t\tshape = [ Math.min(-TRIANGLE_HALFWIDTH, w-px-CORNER_RADIUS), -TRIANGLE_HEIGHT * y_factor,\n\t\t\tMath.min(TRIANGLE_HALFWIDTH, w - px), (-TRIANGLE_HEIGHT - CORNER_RADIUS) * y_factor ];\n\t}\n\telse {\n\t\tshape = [ -TRIANGLE_HALFWIDTH, -TRIANGLE_HEIGHT * y_factor,\n\t\t\t\tTRIANGLE_HALFWIDTH, -TRIANGLE_HEIGHT * y_factor ];\n\t}\n\n\treturn { pos: [px, y_pos], shape: shape }\n};\n\nfunction vFlexTriangle(w, h, x, y, cb, x_factor, x_pos) {\n\tvar t = y - h/2 - TRIANGLE_HEIGHT, b = y + h/2 + TRIANGLE_HEIGHT,\n\t    py = h/2 + Math.min(0, t - cb.top) + Math.max(0, b - cb.bottom),\n\t    shape;\n\n\tif (py - TRIANGLE_HALFWIDTH < CORNER_RADIUS) {\n\t\tshape = [ (-TRIANGLE_HEIGHT - CORNER_RADIUS) * x_factor, -py,\n\t\t\t\t-TRIANGLE_HEIGHT * x_factor, Math.max(TRIANGLE_HALFWIDTH, CORNER_RADIUS - py) ];\n\t}\n\telse if (py + TRIANGLE_HALFWIDTH > h - CORNER_RADIUS) {\n\t\tshape = [ -TRIANGLE_HEIGHT * x_factor, Math.min(-TRIANGLE_HALFWIDTH, h-py-CORNER_RADIUS),\n\t\t\t(-TRIANGLE_HEIGHT - CORNER_RADIUS) * x_factor, Math.min(TRIANGLE_HALFWIDTH, h - py) ];\n\t}\n\telse {\n\t\tshape = [ -TRIANGLE_HEIGHT * x_factor, -TRIANGLE_HALFWIDTH,\n\t\t\t\t-TRIANGLE_HEIGHT * x_factor, TRIANGLE_HALFWIDTH ];\n\t}\n\n\treturn { pos: [x_pos, py], shape: shape }\n};\n\nlocateTriangle.bottomFlexible = function locateTriangle_bottomFlexible(w, h, x, y, cb) {\n\treturn hFlexTriangle(w, h, x, y, cb, +1, h + TRIANGLE_HEIGHT);\n};\n\nlocateTriangle.topFlexible = function locateTriangle_topFlexible(w, h, x, y, cb) {\n\treturn hFlexTriangle(w, h, x, y, cb, -1, -TRIANGLE_HEIGHT);\n};\n\nlocateTriangle.rightFlexible = function locateTriangle_rightFlexible(w, h, x, y, cb) {\n\treturn vFlexTriangle(w, h, x, y, cb, +1, w + TRIANGLE_HEIGHT);\n};\n\nlocateTriangle.leftFlexible = function locateTriangle_leftFlexible(w, h, x, y, cb) {\n\treturn vFlexTriangle(w, h, x, y, cb, -1, -TRIANGLE_HEIGHT);\n};\n\nfunction boxBounds(dir, w, h, x, y, cb) {\n\tvar lt = locateTriangle[dir](w, h, x, y, cb),\n\t    left = x - BORDER - lt.pos[0],\n\t    top = y - BORDER - lt.pos[1];\n\treturn { left: left, top: top, right: left + w + 2*BORDER, bottom: top + h + 2*BORDER };\n}\n\nfunction positionBox(dir, s, path, w, h, x, y, clientX, clientY, cb) {\n\tvar lt = locateTriangle[dir](w, h, clientX, clientY, cb);\n\ts.left = (x - BORDER - lt.pos[0]) + \"px\";\n\ts.top = (y - BORDER - lt.pos[1]) + \"px\";\n\tpath.setAttribute(\"d\", \"M0,0L\" + lt.shape.join(\",\") + \"Z\");\n\tpath.setAttribute(\"transform\", \"translate(\" + (lt.pos[0] + BORDER) + \",\" + (lt.pos[1] + BORDER) + \")\");\n}\n\n\nPopup.prototype.__maxContentWidth = function Popup__maxContentWidth(cb) {\n\tif (this._maxWidth.match(/^\\d+(?:\\.\\d+)?%$/)) {\n\t\treturn cb.width * parseFloat(this._maxWidth) / 100;\n\t}\n\tif (this._maxWidth.match(/^\\d+(?:\\.\\d+)?(?:px)?$/)) {\n\t\treturn parseFloat(this._maxWidth);\n\t}\n\tif (this._maxWidth != null) {\n\t\tconsole.error(\"Popup: Unknown value for maxWidth: \" + this._maxWidth);\n\t}\n\treturn cb.width;\n};\n\nPopup.prototype.draw = function Popup_draw() {\n\tif (!this._point) {\n\t\tconsole.error(\"Popup: cannot draw popup till point() has been specified\");\n\t\treturn;\n\t}\n\n\tvar doc_rect = document.documentElement.getBoundingClientRect(),\n\t    clientX = this._point[0], clientY = this._point[1],\n\t    cb = this._container.getBoundingClientRect();\n\n\tif (clientX < cb.left) clientX = cb.left;\n\telse if (clientX > cb.right) clientX = cb.right;\n\tif (clientY < cb.top) clientY = cb.top;\n\telse if (clientY > cb.bottom) clientY = cb.bottom;\n\n\tvar x = clientX - doc_rect.left, y = clientY - doc_rect.top;\n\n\tvar el = this._getElement(), s = el.style,\n\tsvg = el.querySelector(\".flourish-popup-svg\"),\n\tg = svg.querySelector(\"g\"),\n\trect = g.querySelector(\"rect\"),\n\tpath = g.querySelector(\"path\"),\n\tcontent = el.querySelector(\".flourish-popup-content\");\n\n\ts.display = \"block\";\n\tcontent.style.maxWidth = this.__maxContentWidth(cb) + \"px\";\n\tcontent.innerHTML = this._html;\n\tvar content_box = content.getBoundingClientRect(),\n\t    w, h;\n\tdo {\n\t\tw = Math.ceil(content_box.width);\n\t\th = Math.ceil(content_box.height);\n\t\ts.width = (w + 2*BORDER) + \"px\";\n\t\ts.height = (h + 2*BORDER) + \"px\";\n\t\tcontent_box = content.getBoundingClientRect();\n\t} while (w != Math.ceil(content_box.width) || h != Math.ceil(content_box.height));\n\n\trect.setAttribute(\"width\", w);\n\trect.setAttribute(\"height\", h);\n\tsvg.setAttribute(\"width\", w + 2*BORDER);\n\tsvg.setAttribute(\"height\", h + 2*BORDER);\n\n\tvar overlap = BORDER - TRIANGLE_HEIGHT;\n\tvar first_fit = null, best_horizontal_fit = null, best_vertical_fit = null,\n\t    least_horizontal_protrusion = Infinity, least_vertical_protrusion = Infinity,\n\t    vp_at_least_hp, hp_at_least_vp;\n\tfor (var i = 0; i < this._directions.length; i++) {\n\t\tvar dir = this._directions[i],\n\t\t    b = boxBounds(dir, w, h, clientX, clientY, cb),\n\t\t    horizontal_protrusion = Math.max(0, Math.floor(cb.left) - b.left - overlap)\n\t\t    \t+ Math.max(0, b.right - Math.ceil(cb.right) - overlap),\n\t\t    vertical_protrusion = Math.max(0, Math.floor(cb.top) - b.top - overlap)\n\t\t    \t+ Math.max(0, b.bottom - Math.ceil(cb.bottom) - overlap);\n\n\t\tif (horizontal_protrusion == 0 && vertical_protrusion == 0) {\n\t\t\tfirst_fit = dir;\n\t\t\tbreak;\n\t\t}\n\t\tif (horizontal_protrusion < least_horizontal_protrusion\n\t\t|| (horizontal_protrusion == least_horizontal_protrusion\n\t\t    && vertical_protrusion < vp_at_least_hp))\n\t\t{\n\t\t\tleast_horizontal_protrusion = horizontal_protrusion;\n\t\t\tvp_at_least_hp = vertical_protrusion;\n\t\t\tbest_horizontal_fit = dir;\n\t\t}\n\t\tif (vertical_protrusion < least_vertical_protrusion\n\t\t|| (vertical_protrusion == least_vertical_protrusion\n\t\t    && horizontal_protrusion < hp_at_least_vp))\n\t\t{\n\t\t\tleast_vertical_protrusion = vertical_protrusion;\n\t\t\thp_at_least_vp = horizontal_protrusion;\n\t\t\tbest_vertical_fit = dir;\n\t\t}\n\t}\n\n\t// If the box can be fit completely within the container, do that\n\tif (first_fit) {\n\t\tdir = first_fit;\n\t}\n\t// Otherwise use the fallback fit (horizontal or vertical) if specified\n\telse if (this._fallbackFit == \"horizontal\") {\n\t\tdir = best_horizontal_fit;\n\t}\n\telse if (this._fallbackFit == \"vertical\") {\n\t\tdir = best_vertical_fit;\n\t}\n\t// If all else fails, issue a warning and use the first specified direction.\n\telse {\n\t\tconsole.warn(\"Popup: failed to point box of size (\" + w + \", \" + h + \")\" +\n\t\t\t\" at (\" + clientX + \", \" + clientY + \") within (\" +\n\t\t\tcb.left + \", \" + cb.top +\", \" + cb.right + \", \" + cb.bottom + \")\");\n\t\tdir = this._directions[0];\n\t}\n\n\t// Position the box and return\n\tpositionBox(dir, s, path, w, h, x, y, clientX, clientY, cb);\n\treturn this;\n}\n\nPopup.prototype.hide = function Popup_hide() {\n\tthis._getElement().style.display = \"none\";\n\treturn this;\n}\n\n\nfunction Flourish_popup() {\n\treturn new Popup();\n}\nFlourish_popup.version = VERSION;\n\nexport default Flourish_popup;\n","// import * as d3 from \"d3\";\n// import { select as $, selectAll as $$ } from \"d3\";\nvar $ = d3.select, $$ = d3.selectAll;\n\nimport Popup from \"@flourish/popup\";\n\nvar svg, plot, h, w, x, y, colors;\n\nvar line = d3.line()\n\t.x(function(d, i) { return x(i); })\n\t.y(function(d) { return y(d); });\n\nexport var data = {};\n\nexport var state = {\n\tmargin_top: 100,\n\tmargin_right: 120,\n\tmargin_bottom: 50,\n\tmargin_left: 50,\n\n\tstart_circle_r: 2,\n\tend_circle_r: 10,\n\tlabel_font_size: 12,\n\trank_font_size: 14,\n\n\tpalette: \"schemeCategory20\",\n\n\tshade: true,\n\tshade_opacity: 0.1,\n\tshade_width: 20,\n\n\tline_opacity: 1,\n\tline_width: 2,\n\n\tduration: 300,\n\ttimeslice: 0\n};\n\nexport function update() {\n\n\tsvg.attr(\"width\", window.innerWidth).attr(\"height\", window.innerHeight);\n\tplot.attr(\"transform\", \"translate(\" + state.margin_left + \",\" + state.margin_top + \")\");\n\tw = window.innerWidth - state.margin_left - state.margin_right;\n\th = window.innerHeight - state.margin_top - state.margin_bottom;\n\t$(\"#clip rect\").attr(\"height\", h + state.shade_width).attr(\"transform\", \"translate(0,-\" + state.shade_width/2 + \")\");\n\n\n\tx = d3.scaleLinear().range([0, w]).domain(d3.extent(data.horserace, function(d, i) { return i; }));\n\ty = d3.scaleLinear().range([h, 0]).domain([\n\t\td3.max(data.horserace, function(d) { return d3.max(d.horses, function(v) { return +v; }); }),\n\t\td3.min(data.horserace, function(d) { return d3.min(d.horses, function(v) { return +v; }); })\n\t]);\n\n\tcolors = d3[state.palette];\n\tfunction color(d, i) { return colors[i % colors.length]; }\n\n\tvar xAxis = d3.axisTop(x).tickFormat(function(d) { return data.horserace[d].timeslice });\n\t$(\".x.axis\").call(xAxis)\n\t\t.selectAll(\"text\")\n\t\t.style(\"text-anchor\",\"start\")\n\t\t.attr(\"dx\", \"2.3em\")\n\t\t.attr(\"dy\", \"-0.9em\")\n\t\t.attr(\"transform\", \"rotate(-45)\");\n\n\tvar yAxis = d3.axisLeft(y).tickSize(-w).tickPadding(10);\n\t$(\".y.axis\").call(yAxis);\n\n\tvar horses = [];\n\tfor (var i = 0; i < data.horserace.column_names.horses.length; i++) {\n\t\tvar header = data.horserace.column_names.horses[i];\n\t\tvar ranks = [];\n\t\tfor (var j = 0; j < data.horserace.length; j++) {\n\t\t\tvar timeslice = data.horserace[j].horses;\n\t\t\tranks.push(timeslice[i]);\n\t\t}\n\t\thorses.push({ name: header, ranks: ranks });\n\t}\n\n\tvar lines = plot.selectAll(\".horse\").data(horses);\n\tvar lines_enter = lines.enter().append(\"g\").attr(\"class\", \"horse\")\n\t\t.on(\"mouseover\", mouseover).on(\"mouseout\", mouseout);\n\tlines_enter.append(\"path\").attr(\"class\", \"shade\")\n\t\t.attr(\"clip-path\", \"url(#clip)\")\n\t\t.attr(\"fill\", \"none\");\n\tlines_enter.append(\"path\").attr(\"class\", \"line\")\n\t\t.attr(\"clip-path\", \"url(#clip)\")\n\t\t.attr(\"fill\", \"none\");\n\tvar lines_update = lines.merge(lines_enter);\n\tlines_update\n\t\t.select(\".line\")\n\t\t.attr(\"d\", function(d) { return line(d.ranks); })\n\t\t.attr(\"stroke\", color)\n\t\t.attr(\"opacity\", state.line_opacity)\n\t\t.attr(\"stroke-width\", state.line_width);\n\tlines_update\n\t\t.select(\".shade\")\n\t\t.attr(\"d\", function(d) { return line(d.ranks); })\n\t\t.attr(\"stroke\", color)\n\t\t.attr(\"display\", state.shade ? \"block\" : \"none\")\n\t\t.attr(\"opacity\", state.shade_opacity)\n\t\t.attr(\"stroke-width\", state.shade_width);\n\tlines.exit().remove();\n\n\tvar start_circles = plot.selectAll(\".start.circle\").data(horses);\n\tvar start_circles_enter = start_circles.enter().append(\"circle\").attr(\"class\", \"horse start circle\")\n\t\t.attr(\"cx\", \"0\")\n\t\t.attr(\"cy\", function(d) { return y(d.ranks[0]); })\n\t\t.attr(\"r\", 5)\n\t\t.attr(\"fill\", color);\n\tstart_circles.merge(start_circles_enter).select(\".start.circle\")\n\t\t.attr(\"r\", state.start_circle_r);\n\tstart_circles.exit().remove();\n\n\tvar labels = plot.selectAll(\".end-group\").data(horses);\n\tvar labels_enter = labels.enter().append(\"g\").attr(\"class\", \"horse\").attr(\"fill\", color)\n\t\t.on(\"mouseover\", mouseover).on(\"mouseout\", mouseout);\n\tvar end_group = labels_enter.append(\"g\").attr(\"class\", \"end-group\")\n\t\t.attr(\"transform\", function(d) { return \"translate(\" + x(state.timeslice) + \",\" + y(d.ranks[state.timeslice]) + \")\"; });\n\tend_group.append(\"circle\").attr(\"class\", \"end circle\")\n\t\t.attr(\"fill\", color);\n\tend_group.append(\"text\").attr(\"class\", \"rank-number\")\n\t\t.attr(\"alignment-baseline\", \"central\").attr(\"fill\", \"white\")\n\t\t.attr(\"text-anchor\", \"middle\");\n\tend_group.append(\"text\").attr(\"class\", \"name\")\n\t\t.attr(\"alignment-baseline\", \"central\")\n\t\t.attr(\"x\", state.end_circle_r + 2)\n\t\t.text(function(d) { return d.name; });\n\tvar labels_update = labels.merge(labels_enter);\n\tlabels_update.select(\".end.circle\").attr(\"r\", state.end_circle_r);\n\tlabels_update.select(\".rank-number\").attr(\"font-size\", state.rank_font_size);\n\tlabels_update.select(\".name\").attr(\"font-size\", state.label_font_size);\n\tlabels.exit().remove();\n\t\n\tplay();\n}\n\nfunction mouseover(d, i) {\n\t$$(\".horse\").attr(\"opacity\", function(d) {\n\t\treturn data.horserace.column_names.horses[i] == d.name ? 1 : 0.05;\n\t});\n}\n\nfunction mouseout(d, i) {\n\t$$(\".horse\").attr(\"opacity\", 1);\n}\n\nexport function draw() {\n\tvar body = $(\"body\");\n\tsvg = body.append(\"svg\");\n\n\tplot = svg.append(\"g\").attr(\"id\", \"plot\");\n\tplot.append(\"clipPath\").attr(\"id\", \"clip\").append(\"rect\").attr(\"width\", 0);\n\n\tplot.append(\"g\").attr(\"class\", \"x axis\");\n\tplot.append(\"g\").attr(\"class\", \"y axis\");\n\n\tbody.append(\"div\").attr(\"id\", \"replay\")\n\t\t.style(\"position\", \"absolute\")\n\t\t.style(\"left\", \"10px\")\n\t\t.style(\"top\", \"10px\")\n\t\t.text(\"Replay\").on(\"click\", play);\n\n\tupdate();\n\twindow.onresize = update;\n}\n\nfunction play() {\n\tfor (var t = 0; t < data.horserace.length; t++) {\n\t\t$(\"#clip rect\").transition().ease(d3.easeLinear).duration(state.duration)\n\t\t\t.delay(t * state.duration)\n\t\t\t.attr(\"width\", x(t));\n\t\t$$(\".end-group\").transition().ease(d3.easeLinear).duration(state.duration)\n\t\t\t.delay(t * state.duration)\n\t\t\t.attr(\"transform\", function(d) { return \"translate(\" + x(t) + \",\" + y(d.ranks[t]) + \")\"; })\n\t\t\t.select(\".rank-number\").text(function(d) { return d.ranks[t]; });\n\t}\n}\n"],"names":["Popup","this","unique_id","next_unique_id","_container","document","body","_maxWidth","_point","_html","_directions","ALL_DIRECTIONS","_fallbackFit","handlers","click","textToHtml","text","replace","s","&","<",">","svgElement","tagName","attrs","styles","k","element","createElementNS","setAttribute","style","hFlexTriangle","w","h","x","y","cb","y_factor","y_pos","shape","l","TRIANGLE_HEIGHT","r","px","Math","min","left","max","right","TRIANGLE_HALFWIDTH","CORNER_RADIUS","pos","vFlexTriangle","x_factor","x_pos","t","b","py","top","bottom","boxBounds","dir","lt","locateTriangle","BORDER","positionBox","path","clientX","clientY","join","update","color","d","i","colors","length","svg","attr","window","innerWidth","innerHeight","plot","state","margin_left","margin_top","margin_right","margin_bottom","$","shade_width","d3","scaleLinear","range","domain","extent","data","horserace","horses","v","palette","xAxis","axisTop","tickFormat","timeslice","call","selectAll","yAxis","axisLeft","tickSize","tickPadding","column_names","header","ranks","j","push","name","lines","lines_enter","enter","append","on","mouseover","mouseout","lines_update","merge","select","line","line_opacity","line_width","shade","shade_opacity","exit","remove","start_circles","start_circles_enter","start_circle_r","labels","labels_enter","end_group","end_circle_r","labels_update","rank_font_size","label_font_size","play","$$","draw","onresize","transition","ease","easeLinear","duration","delay","proto","charAt","substr","prototype","point","arg1","arg2","HTMLElement","SVGElement","getBoundingClientRect","floor","width","height","console","error","event","handler","Error","fire","_getElement","popup","id","el","getElementById","createElement","className","display","margin","padding","position","boxSizing","addEventListener","e","class","filter","appendChild","in","stdDeviation","dx","dy","result","fe_component_transfer","type","slope","fe_merge","g","fill","stroke","rx","content","topLeft","bottomLeft","topRight","bottomRight","bottomFlexible","topFlexible","rightFlexible","leftFlexible","__maxContentWidth","match","parseFloat","doc_rect","documentElement","querySelector","rect","maxWidth","innerHTML","content_box","ceil","vp_at_least_hp","hp_at_least_vp","overlap","first_fit","best_horizontal_fit","best_vertical_fit","least_horizontal_protrusion","Infinity","least_vertical_protrusion","horizontal_protrusion","vertical_protrusion","warn","hide"],"mappings":"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"}